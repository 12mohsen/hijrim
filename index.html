<!DOCTYPE html>
<html dir="rtl" lang="ar" class="light-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù‡Ø¬Ø±ÙŠ ÙˆØ§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3498db">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700&family=IBM+Plex+Sans+Arabic:wght@300;400;500;600&family=Tajawal:wght@200;300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Fonts */
            --heading-font: 'Almarai', sans-serif;
            --body-font: 'IBM Plex Sans Arabic', sans-serif;
            --numbers-font: 'Tajawal', sans-serif;
            
            /* Light theme */
            --bg-color-light: #eef2f3;
            --text-color-light: #2c3e50;
            --border-color-light: #bdc3c7;
            --card-bg-light: #ffffff;
            --button-bg-light: #3498db;
            --button-hover-light: #2980b9;

            /* Dark theme */
            --bg-color-dark: #1a1a1a;
            --text-color-dark: #ffffff;
            --border-color-dark: #333333;
            --card-bg-dark: #2d2d2d;
            --button-bg-dark: #3498db;
            --button-hover-dark: #2980b9;
        }

        /* Default theme (light) */
        :root {
            --bg-color: var(--bg-color-light);
            --text-color: var(--text-color-light);
            --border-color: var(--border-color-light);
            --card-bg: var(--card-bg-light);
            --button-bg: var(--button-bg-light);
            --button-hover: var(--button-hover-light);
        }

        /* Dark theme */
        :root[data-theme="dark"] {
            --bg-color: var(--bg-color-dark);
            --text-color: var(--text-color-dark);
            --border-color: var(--border-color-dark);
            --card-bg: var(--card-bg-dark);
            --button-bg: var(--button-bg-dark);
            --button-hover: var(--button-hover-dark);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            margin: 0;
            padding: 40px;
            font-family: var(--body-font);
            line-height: 1.6;
            font-weight: 400;
        }

        h1, h2, h3 {
            font-family: var(--heading-font);
            font-weight: 700;
            margin-bottom: 1rem;
            letter-spacing: -0.5px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
        }

        h2 {
            font-size: 1.8rem;
            color: var(--text-color);
            opacity: 0.9;
        }

        h3 {
            font-size: 1.4rem;
            color: var(--text-color);
            opacity: 0.85;
        }

        p {
            margin: 0.8rem 0;
            line-height: 1.7;
        }

        input[type="date"] {
            font-family: var(--numbers-font);
            font-size: 1.1rem;
            font-weight: 500;
            padding: 0.8rem 1.2rem;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(255,255,255,0.05) 100%);
            color: var(--text-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
        }

        input[type="date"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        input[type="date"]:focus {
            outline: none;
            border-color: var(--button-bg);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .date-display {
            font-family: var(--numbers-font);
            font-size: 1.2rem;
            font-weight: 500;
            margin: 1rem 0;
            padding: 1.2rem;
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(255,255,255,0.1) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .date-display:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.12);
        }

        #today-gregorian, #today-hijri,
        #converted-gregorian, #converted-hijri {
            font-family: var(--numbers-font);
            font-size: 1.3rem;
            font-weight: 500;
            margin: 1rem 0;
            padding: 1.5rem;
            border-radius: 15px;
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(255,255,255,0.05) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        #today-gregorian::before, #today-hijri::before,
        #converted-gregorian::before, #converted-hijri::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 0%, rgba(255,255,255,0.05) 50%, transparent 100%);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        #today-gregorian:hover::before, #today-hijri:hover::before,
        #converted-gregorian:hover::before, #converted-hijri:hover::before {
            transform: translateX(100%);
        }

        #today-gregorian:hover, #today-hijri:hover,
        #converted-gregorian:hover, #converted-hijri:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.12);
        }

        .favorite-item {
            font-family: var(--body-font);
            font-size: 1.1rem;
            padding: 1.2rem;
            margin: 0.8rem 0;
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(255,255,255,0.05) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
        }

        .favorite-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        .date-section, .converter-section, .favorites-section, .diff-calculator-section, .events-section {
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(255,255,255,0.02) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .date-section:hover, .converter-section:hover, 
        .favorites-section:hover, .diff-calculator-section:hover, .events-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.12);
        }

        .favorite-btn, .calc-btn {
            background: linear-gradient(135deg, var(--button-bg) 0%, var(--button-hover) 100%);
            border: none;
            padding: 1rem 2rem;
            color: white;
            font-family: var(--heading-font);
            font-weight: 700;
            font-size: 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .favorite-btn:hover, .calc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            background: linear-gradient(135deg, var(--button-hover) 0%, var(--button-bg) 100%);
        }

        .theme-toggle {
            position: fixed;
            top: 60px;
            left: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
            z-index: 1000;
            padding: 10px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--card-bg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .reminder-toggle {
            position: fixed;
            top: 60px;
            right: 20px;
            background: none;
            border: none;
            font-size: 22px;
            cursor: pointer;
            color: var(--text-color);
            z-index: 1000;
            padding: 10px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--card-bg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.3s, opacity 0.3s;
        }

        .reminder-toggle.off {
            opacity: 0.5;
        }

        :root {
            --bg-gradient: linear-gradient(to right, var(--bg-color), var(--bg-color));
        }

        [data-theme="dark"] {
            --bg-gradient: linear-gradient(to right, var(--bg-color), var(--bg-color));
        }

        body {
            font-family: var(--body-font);
            background: var(--bg-gradient);
            color: var(--text-color);
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .date-section, .converter-section, .favorites-section, .diff-calculator-section, .events-section {
            margin-bottom: 20px;
        }

        .date-section h2, .converter-section h2, .favorites-section h2, .diff-calculator-section h2, .events-section h2 {
            margin-top: 0;
        }

        .date-inputs {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .date-inputs label {
            margin-right: 10px;
        }

        .favorite-btn, .calc-btn {
            background-color: var(--button-bg);
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px 5px;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            font-family: var(--heading-font);
            transition: background-color 0.3s;
        }

        .favorite-btn:hover, .calc-btn:hover {
            background-color: var(--button-hover);
        }

        .favorite-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .favorite-item span {
            cursor: pointer;
        }

        .remove-btn {
            background-color: transparent;
            border: none;
            padding: 0;
            font-size: 16px;
            cursor: pointer;
        }

        .favorites-section {
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            background-color: var(--card-bg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .favorites-list {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
        }

        .favorite-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 10px 0;
        }

        .favorite-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin: 5px 0;
            background-color: var(--bg-color);
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .favorite-item:hover {
            background-color: var(--button-bg);
            color: white;
        }

        .favorite-item span {
            cursor: pointer;
            flex-grow: 1;
        }

        .remove-btn {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            padding: 0 8px;
            font-size: 16px;
        }

        .favorite-btn, .clear-btn {
            background-color: var(--button-bg);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .favorite-btn:hover, .clear-btn:hover {
            background-color: var(--button-hover);
        }

        .clear-btn {
            background-color: #e74c3c;
        }

        .clear-btn:hover {
            background-color: #c0392b;
        }

        .note-input {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--body-font);
            resize: vertical;
            min-height: 60px;
        }

        .favorite-note {
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
            margin-top: 5px;
            font-style: italic;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
        }

        .modal-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .modal-buttons button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: var(--body-font);
        }

        .save-btn {
            background-color: var(--button-bg);
            color: white;
        }

        .cancel-btn {
            background-color: #e74c3c;
            color: white;
        }

        .footer {
            text-align: center;
            padding: 2rem 0;
            margin-top: 2rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .signature {
            font-family: var(--heading-font);
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-color);
            opacity: 0.8;
            display: inline-block;
            padding: 0.5rem 2rem;
            border-radius: 20px;
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(255,255,255,0.05) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
        }

        .signature:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            opacity: 1;
        }

        .signature span {
            background: linear-gradient(135deg, var(--text-color) 0%, var(--button-bg) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }

        /* Responsive Design */
        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px;
                margin: 0;
                border-radius: 15px;
            }

            .date-section, .converter-section, 
            .favorites-section, .diff-calculator-section, .events-section {
                padding: 1.2rem;
                margin-bottom: 1.5rem;
            }

            h1 {
                font-size: 1.8rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            #today-gregorian, #today-hijri,
            #converted-gregorian, #converted-hijri {
                font-size: 1.1rem;
                padding: 1rem;
                margin: 0.8rem 0;
            }

            .favorite-item {
                padding: 1rem;
                margin: 0.6rem 0;
                font-size: 1rem;
            }

            .favorite-note {
                font-size: 0.9rem;
            }

            input[type="date"] {
                width: 100%;
                margin: 0.5rem 0;
                font-size: 1rem;
            }

            .favorite-btn, .calc-btn {
                width: 100%;
                margin: 0.5rem 0;
                padding: 0.8rem;
                font-size: 1rem;
            }

            .theme-toggle {
                top: 10px;
                left: 10px;
                width: 40px;
                height: 40px;
                font-size: 20px;
            }

            .reminder-toggle {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
                font-size: 18px;
            }

            .modal-content {
                width: 95%;
                padding: 15px;
                margin: 10px;
            }

            .note-input {
                min-height: 80px;
            }

            .signature {
                font-size: 1rem;
                padding: 0.5rem 1.5rem;
            }

            /* Fix for small screens */
            .date-inputs {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .date-inputs input[type="date"] {
                margin: 5px 0;
            }

            /* Better touch targets */
            button, 
            input[type="date"],
            .favorite-item,
            .theme-toggle {
                min-height: 44px; /* Minimum touch target size */
            }

            /* Improved spacing for mobile */
            .footer {
                margin-top: 1.5rem;
                padding: 1.5rem 0;
            }

            /* Better modal on mobile */
            .modal {
                padding: 10px;
            }

            .modal-buttons {
                flex-direction: column;
                gap: 10px;
            }

            .modal-buttons button {
                width: 100%;
                padding: 12px;
            }

            /* Fix for date picker on mobile */
            input[type="date"]::-webkit-calendar-picker-indicator {
                width: 24px;
                height: 24px;
                margin-right: -8px;
            }
        }

        /* Extra small devices */
        @media screen and (max-width: 380px) {
            body {
                padding: 5px;
            }

            .container {
                padding: 10px;
            }

            h1 {
                font-size: 1.6rem;
            }

            h2 {
                font-size: 1.3rem;
            }

            #today-gregorian, #today-hijri,
            #converted-gregorian, #converted-hijri {
                font-size: 1rem;
                padding: 0.8rem;
            }

            .favorite-item {
                padding: 0.8rem;
            }
        }

        .share-button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-family: var(--body-font);
            font-size: 1rem;
            margin-top: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .share-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .share-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .today-next-event {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            padding: 6px 12px;
            border-radius: 999px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: #ffffff;
            font-size: 0.95rem;
            font-family: var(--body-font);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.18);
            white-space: nowrap;
        }

        .today-next-event span.icon {
            font-size: 1.1rem;
        }

        .today-next-event.islamic-ramadan {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .today-next-event.islamic-eid-fitr {
            background: linear-gradient(135deg, #e67e22, #e74c3c);
        }

        .today-next-event.islamic-hajj {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
        }

        .today-next-event.islamic-eid-adha {
            background: linear-gradient(135deg, #d35400, #e67e22);
        }

        .today-next-event.islamic-hijri-year {
            background: linear-gradient(135deg, #2980b9, #3498db);
        }

        .today-next-event.islamic-ashura {
            background: linear-gradient(135deg, #c0392b, #e74c3c);
        }

        .today-next-event.national-day {
            background: linear-gradient(135deg, #1e8449, #27ae60);
        }

        .today-next-event.national-founding {
            background: linear-gradient(135deg, #6c3483, #884ea0);
        }

        @media (max-width: 600px) {
            .share-button {
                width: 100%;
                margin-top: 15px;
            }
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .share-button {
            flex: 1;
            min-width: 200px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-family: var(--body-font);
            font-size: 1rem;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .share-button.whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
        }

        .share-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .share-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        @media (max-width: 600px) {
            .share-buttons {
                flex-direction: column;
            }
            
            .share-button {
                width: 100%;
            }
        }

        .events-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .upcoming-event {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 20px;
            border-radius: 14px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.18);
            transform: translateY(0);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .upcoming-event::before {
            content: "";
            position: absolute;
            top: 0;
            left: -40%;
            width: 40%;
            height: 100%;
            background: rgba(255, 255, 255, 0.18);
            transform: skewX(-20deg);
            animation: shine 3s infinite;
        }

        .upcoming-event:hover {
            transform: translateY(-4px);
            box-shadow: 0 14px 30px rgba(0, 0, 0, 0.22);
        }

        .upcoming-event.pulse {
            animation: pulse-card 2.5s infinite;
        }

        .upcoming-event.ramadan-card {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .upcoming-event.eid-fitr-card {
            background: linear-gradient(135deg, #e67e22, #e74c3c);
        }

        .upcoming-event.hajj-card {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
        }

        .upcoming-event.eid-adha-card {
            background: linear-gradient(135deg, #d35400, #e67e22);
        }

        .upcoming-event.hijri-year-card {
            background: linear-gradient(135deg, #2980b9, #3498db);
        }

        .upcoming-event.ashura-card {
            background: linear-gradient(135deg, #c0392b, #e74c3c);
        }

        .countdown {
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 10px;
        }

        .events-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .event-card {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .event-card h3 {
            margin: 0 0 10px 0;
            color: var(--text-color);
        }

        .event-card p {
            margin: 0;
            color: var(--text-color);
        }

        .ramadan { border-color: #27ae60; }
        .eid-fitr { border-color: #e74c3c; }
        .hajj { border-color: #8e44ad; }
        .eid-adha { border-color: #d35400; }
        .hijri-year { border-color: #2980b9; }
        .ashura { border-color: #c0392b; }
        .national { border-color: #16a085; }

        @media (max-width: 600px) {
            .events-list {
                grid-template-columns: 1fr;
            }
        }

        .events-ticker {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(45deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: var(--text-color);
            padding: 12px 0;
            z-index: 1000;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            direction: rtl;
            border-bottom: 2px solid var(--border-color);
        }

        .ticker-content {
            display: inline-block;
            white-space: nowrap;
            animation: ticker 45s linear infinite;
            padding-left: 100%;
        }

        .ticker-content:hover {
            animation-play-state: paused;
            cursor: pointer;
        }

        .ticker-item {
            display: inline-block;
            padding: 0 40px;
            font-weight: bold;
            position: relative;
            transition: all 0.3s ease;
            color: var(--text-color);
        }

        .ticker-item:hover {
            transform: scale(1.05);
            text-shadow: 0 0 10px var(--primary-color);
            color: var(--primary-color);
        }

        .ticker-item .days {
            color: var(--primary-color);
            margin: 0 5px;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) skewX(-20deg);
            }
            100% {
                transform: translateX(250%) skewX(-20deg);
            }
        }

        @keyframes pulse-card {
            0% {
                transform: translateY(0) scale(1);
            }
            50% {
                transform: translateY(-2px) scale(1.02);
            }
            100% {
                transform: translateY(0) scale(1);
            }
        }

        .ticker-item .icon {
            margin-left: 8px;
            font-size: 1.2em;
            vertical-align: middle;
        }

        .ticker-item::after {
            content: "â—";
            position: absolute;
            left: 10px;
            color: var(--border-color);
            opacity: 0.5;
        }

        .ticker-item:last-child::after {
            display: none;
        }

        @keyframes ticker {
            0% {
                transform: translate3d(0, 0, 0);
            }
            100% {
                transform: translate3d(-100%, 0, 0);
            }
        }

        /* Adjust container padding for the ticker */
        .container {
            padding-top: 70px;
        }

        /* Adjust theme toggle position */
        .theme-toggle {
            top: 70px;
        }

        /* Add reminder toggle */
        .reminder-toggle {
            position: fixed;
            top: 70px;
            right: 60px;
            background-color: var(--primary-color);
            color: var(--text-color);
            border: none;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
            z-index: 1000;
        }

        .reminder-toggle.off {
            background-color: #ccc;
        }
    </style>
</head>
<body>
    <!-- Events Ticker -->
    <div class="events-ticker">
        <div class="ticker-content" id="ticker-content">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <button class="theme-toggle" onclick="toggleTheme()" title="ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¸Ù‡Ø±">
        <span id="theme-icon">ğŸŒ</span>
    </button>
    <button class="reminder-toggle" id="reminder-toggle" onclick="toggleReminders()" title="ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª">
        <span id="reminder-icon">ğŸ””</span>
    </button>
    <div class="container">
        <!-- Today's Date Section -->
        <div class="date-section">
            <h2>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…</h2>
            <div class="date-display">
                <h2 id="today-gregorian">ğŸ“… Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ...</h2>
                <h2 id="today-hijri">ğŸ•Œ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ...</h2>
                <div id="today-next-event" class="today-next-event" style="display:none;">
                    <span class="icon">ğŸŠ</span>
                    <span id="today-next-event-text">Ø£Ù‚Ø±Ø¨ Ù…Ù†Ø§Ø³Ø¨Ø© Ø³ÙŠØªÙ… Ø¹Ø±Ø¶Ù‡Ø§ Ù‡Ù†Ø§</span>
                </div>
                <div id="today-next-national" class="today-next-event" style="display:none;">
                    <span class="icon">ğŸ‡¸ğŸ‡¦</span>
                    <span id="today-next-national-text">Ø£Ù‚Ø±Ø¨ Ù…Ù†Ø§Ø³Ø¨Ø© ÙˆØ·Ù†ÙŠØ© Ø³ÙŠØªÙ… Ø¹Ø±Ø¶Ù‡Ø§ Ù‡Ù†Ø§</span>
                </div>
                <div class="share-buttons">
                    <button onclick="shareToWhatsApp()" class="share-button whatsapp">
                        <span>Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨</span> ğŸ’¬
                    </button>
                    <button onclick="shareDate()" class="share-button">
                        <span>Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø£Ø®Ø±Ù‰</span> ğŸ“¤
                    </button>
                </div>
            </div>
        </div>

        <!-- Date Converter Section -->
        <div class="converter-section">
            <h2>Ù…Ø­ÙˆÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®</h2>
            <input type="date" id="datePicker" onchange="convertDate()">
            <p id="converted-gregorian"></p>
            <p id="converted-hijri"></p>
        </div>
        
        <!-- Favorites Section -->
        <div class="favorites-section">
            <h2>Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙØ¶Ù„Ø©</h2>
            <div class="favorite-controls">
                <button onclick="addToFavorites()" class="favorite-btn">â­ Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©</button>
                <button onclick="clearFavorites()" class="clear-btn">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
            </div>
            <div id="favorites-list" class="favorites-list"></div>
        </div>

        <!-- Date Difference Calculator -->
        <div class="diff-calculator-section">
            <h2>Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† ØªØ§Ø±ÙŠØ®ÙŠÙ†</h2>
            <div class="date-inputs">
                <div>
                    <label for="startDate">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£ÙˆÙ„:</label>
                    <input type="date" id="startDate">
                </div>
                <div>
                    <label for="endDate">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
                    <input type="date" id="endDate">
                </div>
            </div>
            <button onclick="calculateDifference()" class="calc-btn">Ø§Ø­Ø³Ø¨ Ø§Ù„ÙØ±Ù‚</button>
            <p id="date-difference"></p>
        </div>

        <!-- Islamic Events Section -->
        <div class="events-section">
            <h2>Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</h2>
            <div class="upcoming-event" id="upcoming-event">
                <h3>Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h3>
                <p id="next-event">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
                <div class="countdown" id="event-countdown"></div>
            </div>
            <div class="events-list">
                <div class="event-card ramadan">
                    <h3>Ø´Ù‡Ø± Ø±Ù…Ø¶Ø§Ù†</h3>
                    <p id="ramadan-date">-</p>
                </div>
                <div class="event-card eid-fitr">
                    <h3>Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø±</h3>
                    <p id="eid-fitr-date">-</p>
                </div>
                <div class="event-card hajj">
                    <h3>Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬</h3>
                    <p id="hajj-date">-</p>
                </div>
                <div class="event-card eid-adha">
                    <h3>Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰</h3>
                    <p id="eid-adha-date">-</p>
                </div>
                <div class="event-card hijri-year">
                    <h3>Ø±Ø£Ø³ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù‡Ø¬Ø±ÙŠØ©</h3>
                    <p id="new-year-date">-</p>
                </div>
                <div class="event-card ashura">
                    <h3>ÙŠÙˆÙ… Ø¹Ø§Ø´ÙˆØ±Ø§Ø¡</h3>
                    <p id="ashura-date">-</p>
                </div>
            </div>
        </div>
        
        <!-- National Events Section -->
        <div class="events-section">
            <h2>Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„ÙˆØ·Ù†ÙŠØ©</h2>
            <div class="events-list">
                <div class="event-card national">
                    <h3>Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ</h3>
                    <p id="saudi-national-day">-</p>
                </div>
                <div class="event-card national">
                    <h3>ÙŠÙˆÙ… Ø§Ù„ØªØ£Ø³ÙŠØ³</h3>
                    <p id="saudi-founding-day">-</p>
                </div>
            </div>
        </div>

        <!-- Cultural Events Section -->
        <div class="events-section">
            <h2>Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø«Ù‚Ø§ÙÙŠØ© ÙˆØ§Ù„Ù…Ø¹Ø§Ø±Ø¶</h2>
            <div class="events-list">
                <div class="event-card">
                    <h3>Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙŠØ§Ø¶ Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ù„ÙƒØªØ§Ø¨ 2025</h3>
                    <p id="riyadh-bookfair">-</p>
                </div>
                <div class="event-card">
                    <h3>Ù…Ø¹Ø±Ø¶ Ø¬Ø¯Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ù„ÙƒØªØ§Ø¨ 2025</h3>
                    <p id="jeddah-bookfair">-</p>
                </div>
                <div class="event-card">
                    <h3>Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</h3>
                    <p id="arabic-language-day">-</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Modal for Notes -->
    <div id="noteModal" class="modal">
        <div class="modal-content">
            <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©</h3>
            <textarea id="noteInput" class="note-input" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
            <div class="modal-buttons">
                <button onclick="saveWithNote()" class="save-btn">Ø­ÙØ¸</button>
                <button onclick="closeNoteModal()" class="cancel-btn">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="signature">
            ØªØ·ÙˆÙŠØ± <span>Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø­Ø³Ù†</span> Â© Ù¢Ù Ù¢Ù¥
        </div>
    </div>

    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration);
                        
                        // Request notification permission
                        if ('Notification' in window) {
                            Notification.requestPermission();
                        }
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }

        // Arabic month names for Gregorian calendar
        const gregorianMonthsAr = {
            1: "ÙŠÙ†Ø§ÙŠØ±",
            2: "ÙØ¨Ø±Ø§ÙŠØ±",
            3: "Ù…Ø§Ø±Ø³",
            4: "Ø£Ø¨Ø±ÙŠÙ„",
            5: "Ù…Ø§ÙŠÙˆ",
            6: "ÙŠÙˆÙ†ÙŠÙˆ",
            7: "ÙŠÙˆÙ„ÙŠÙˆ",
            8: "Ø£ØºØ³Ø·Ø³",
            9: "Ø³Ø¨ØªÙ…Ø¨Ø±",
            10: "Ø£ÙƒØªÙˆØ¨Ø±",
            11: "Ù†ÙˆÙÙ…Ø¨Ø±",
            12: "Ø¯ÙŠØ³Ù…Ø¨Ø±"
        };

        // Arabic weekday names
        const weekdaysAr = {
            "Saturday": "Ø§Ù„Ø³Ø¨Øª",
            "Sunday": "Ø§Ù„Ø£Ø­Ø¯",
            "Monday": "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†",
            "Tuesday": "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡",
            "Wednesday": "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡",
            "Thursday": "Ø§Ù„Ø®Ù…ÙŠØ³",
            "Friday": "Ø§Ù„Ø¬Ù…Ø¹Ø©"
        };

        // Format a date with Arabic month and weekday
        function formatArabicDate(date, isHijri = false) {
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            const weekdayEn = date.toLocaleDateString('en-US', { weekday: 'long' });
            const weekdayAr = weekdaysAr[weekdayEn] || weekdayEn;
            const monthAr = gregorianMonthsAr[month] || `Ø´Ù‡Ø± ${month}`;
            const suffix = isHijri ? 'Ù‡Ù€' : 'Ù…';
            
            return `${weekdayAr}ØŒ ${day} ${monthAr} ${year}${suffix}`;
        }

        async function fetchToday() {
            try {
                // Get today's date components
                const now = new Date();
                const day = String(now.getDate()).padStart(2, '0');
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const year = now.getFullYear();

                // Store current date for comparison
                localStorage.setItem('currentDate', now.toDateString());

                // Display Gregorian date immediately
                const gregorianDate = formatArabicDate(now);
                document.getElementById("today-gregorian").textContent =
                    `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ: ${gregorianDate}`;
                
                // Save Gregorian date
                localStorage.setItem('lastGregorianDate', gregorianDate);

                // Fetch Hijri date
                const response = await fetch(`https://api.aladhan.com/v1/gToH/${day}-${month}-${year}`);
                const data = await response.json();

                if (response.ok && data.code === 200 && data.data) {
                    const hijri = data.data.hijri;
                    const hijriDate = `${hijri.weekday.ar}ØŒ ${hijri.day} ${hijri.month.ar} ${hijri.year}Ù‡Ù€`;
                    document.getElementById("today-hijri").textContent =
                        `ğŸ•Œ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: ${hijriDate}`;
                    
                    // Save Hijri date
                    localStorage.setItem('lastHijriDate', hijriDate);

                    // Schedule notification for tomorrow morning
                    if ('Notification' in window && Notification.permission === 'granted') {
                        const tomorrow = new Date();
                        tomorrow.setDate(tomorrow.getDate() + 1);
                        tomorrow.setHours(9, 0, 0, 0);

                        const notificationDelay = tomorrow - now;
                        
                        setTimeout(() => {
                            new Notification('Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…', {
                                body: `${gregorianDate}\n${hijriDate}`,
                                icon: 'icon-192.png',
                                tag: 'daily-date', // Ensure only one notification
                                renotify: true // Show even if there's an existing notification
                            });
                        }, notificationDelay);
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                loadLastSavedDates();
            }
        }

        // Function to load last saved dates
        function loadLastSavedDates() {
            const lastGregorianDate = localStorage.getItem('lastGregorianDate');
            const lastHijriDate = localStorage.getItem('lastHijriDate');

            if (lastGregorianDate) {
                document.getElementById("today-gregorian").textContent =
                    `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ: ${lastGregorianDate}`;
            }

            if (lastHijriDate) {
                document.getElementById("today-hijri").textContent =
                    `ğŸ•Œ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: ${lastHijriDate}`;
            }
        }

        async function convertDate() {
            try {
                const datePicker = document.getElementById("datePicker");
                const selectedDate = datePicker.value;
                
                if (!selectedDate) {
                    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ®");
                    return;
                }

                // Show loading state
                document.getElementById("converted-gregorian").textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
                document.getElementById("converted-hijri").textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

                // Parse selected date
                const date = new Date(selectedDate);
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();

                // Display Gregorian date immediately
                document.getElementById("converted-gregorian").textContent =
                    `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ: ${formatArabicDate(date)}`;

                // Fetch Hijri date
                const response = await fetch(`https://api.aladhan.com/v1/gToH/${day}-${month}-${year}`);
                const data = await response.json();

                if (response.ok && data.code === 200 && data.data) {
                    const hijri = data.data.hijri;
                    document.getElementById("converted-hijri").textContent =
                        `ğŸ•Œ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: ${hijri.weekday.ar}ØŒ ${hijri.day} ${hijri.month.ar} ${hijri.year}Ù‡Ù€`;
                } else {
                    throw new Error('API error');
                }
            } catch (error) {
                console.error('Error:', error);
                try {
                    const date = new Date(selectedDate);
                    const hijriDate = date.toLocaleDateString('ar-SA-u-ca-islamic', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    document.getElementById("converted-hijri").textContent =
                        `ğŸ•Œ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: ${hijriDate}`;
                } catch (e) {
                    document.getElementById("converted-hijri").textContent = "ğŸ•Œ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: ØºÙŠØ± Ù…ØªÙˆÙØ±";
                }
            }
        }

        function addToFavorites() {
            const datePicker = document.getElementById("datePicker");
            const selectedDate = datePicker.value;
            
            if (!selectedDate) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ù„Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙØ¶Ù„Ø©");
                return;
            }

            // Show note modal
            document.getElementById('noteModal').style.display = 'flex';
        }

        function saveWithNote() {
            const selectedDate = document.getElementById("datePicker").value;
            const note = document.getElementById("noteInput").value.trim();
            
            // Get current favorites
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            // Check if date already exists
            if (favorites.some(f => f.date === selectedDate)) {
                alert("Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©");
                closeNoteModal();
                return;
            }

            // Add new date with note
            favorites.push({
                date: selectedDate,
                note: note
            });
            
            // Save to localStorage
            localStorage.setItem('favorites', JSON.stringify(favorites));
            
            // Clear note input and close modal
            document.getElementById("noteInput").value = '';
            closeNoteModal();
            
            // Update display
            loadFavorites();
            
            // Show confirmation
            alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙØ¶Ù„Ø©");
        }

        function closeNoteModal() {
            document.getElementById('noteModal').style.display = 'none';
            document.getElementById("noteInput").value = '';
        }

        function loadFavorites() {
            const favoritesList = document.getElementById("favorites-list");
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            // Sanitize favorites: remove any invalid or legacy entries
            favorites = favorites.filter(f => {
                if (!f || typeof f.date !== 'string') return false;
                const d = new Date(f.date);
                return !isNaN(d.getTime());
            });
            // Save back sanitized list
            localStorage.setItem('favorites', JSON.stringify(favorites));
            
            favoritesList.innerHTML = '';
            
            if (favorites.length === 0) {
                favoritesList.innerHTML = '<p style="text-align: center; color: var(--text-color);">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØ§Ø±ÙŠØ® Ù…ÙØ¶Ù„Ø©</p>';
                return;
            }
            
            favorites.forEach((favorite, index) => {
                const dateObj = new Date(favorite.date);
                const formattedDate = formatArabicDate(dateObj);
                const elapsedText = getElapsedSinceDate(dateObj);
                
                const div = document.createElement('div');
                div.className = 'favorite-item';
                div.innerHTML = `
                    <div>
                        <span onclick="selectFavoriteDate('${favorite.date}')">${formattedDate}</span>
                        <div class="favorite-note">${elapsedText}</div>
                        ${favorite.note ? `<div class="favorite-note">${favorite.note}</div>` : ''}
                    </div>
                    <button onclick="removeFavorite(${index})" class="remove-btn" title="Ø­Ø°Ù">âŒ</button>
                `;
                favoritesList.appendChild(div);
            });
        }

        function selectFavoriteDate(date) {
            document.getElementById('datePicker').value = date;
            convertDate();
        }

        function removeFavorite(index) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©ØŸ')) {
                let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
                if (index >= 0 && index < favorites.length) {
                    favorites.splice(index, 1);
                }
                localStorage.setItem('favorites', JSON.stringify(favorites));
                loadFavorites();
            }
        }

        function clearFavorites() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙØ¶Ù„Ø©ØŸ')) {
                localStorage.removeItem('favorites');
                loadFavorites();
            }
        }

        function getElapsedSinceDate(startDate) {
            const now = new Date();

            // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® ØµØ§Ù„Ø­
            if (isNaN(startDate.getTime())) {
                return '';
            }

            // Ù„Ø§ Ù†Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯Ø© Ø¥Ù† ÙƒØ§Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„
            if (startDate > now) {
                return '';
            }

            const diffTime = now - startDate;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const diffMonths = Math.floor(diffDays / 30.44); // Ù…ØªÙˆØ³Ø· Ø£ÙŠØ§Ù… Ø§Ù„Ø´Ù‡Ø±
            const diffYears = Math.floor(diffMonths / 12);
            const remainingMonths = diffMonths % 12;
            const remainingDays = Math.round(diffDays % 30.44);

            let parts = [];
            if (diffYears > 0) {
                parts.push(`${diffYears} Ø³Ù†Ø©`);
            }
            if (remainingMonths > 0) {
                parts.push(`${remainingMonths} Ø´Ù‡Ø±`);
            }
            if (remainingDays > 0 || parts.length === 0) {
                parts.push(`${remainingDays} ÙŠÙˆÙ…`);
            }

            return `Ù…Ø¶Ù‰: ${parts.join(' Ùˆ ')}`;
        }

        function calculateDifference() {
            const startDate = new Date(document.getElementById("startDate").value);
            const endDate = new Date(document.getElementById("endDate").value);
            
            if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠÙ†");
                return;
            }

            const diffTime = Math.abs(endDate - startDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const diffMonths = Math.floor(diffDays / 30.44); // Average days in a month
            const diffYears = Math.floor(diffMonths / 12);
            const remainingMonths = diffMonths % 12;
            const remainingDays = Math.round(diffDays % 30.44);

            let result = "Ø§Ù„ÙØ±Ù‚: ";
            if (diffYears > 0) {
                result += `${diffYears} Ø³Ù†Ø© `;
            }
            if (remainingMonths > 0) {
                result += `${remainingMonths} Ø´Ù‡Ø± `;
            }
            if (remainingDays > 0) {
                result += `${remainingDays} ÙŠÙˆÙ…`;
            }

            document.getElementById("date-difference").textContent = result;
        }

        // Theme toggle functionality
        function toggleTheme() {
            const root = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');
            const currentTheme = root.getAttribute('data-theme');
            
            if (currentTheme === 'dark') {
                root.removeAttribute('data-theme');
                themeIcon.textContent = 'ğŸŒ';
                localStorage.setItem('theme', 'light');
            } else {
                root.setAttribute('data-theme', 'dark');
                themeIcon.textContent = 'ğŸŒ™';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Schedule next update at midnight
        function scheduleNextUpdate() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const timeUntilMidnight = tomorrow - now;
            
            setTimeout(() => {
                fetchToday();
                scheduleNextUpdate(); // Schedule next day's update
            }, timeUntilMidnight);
        }

        // Auto-refresh date every minute to catch day changes
        function startAutoRefresh() {
            setInterval(() => {
                const now = new Date();
                // If we're in a new day (current stored date is different from actual date)
                const storedDate = localStorage.getItem('currentDate');
                const currentDate = now.toDateString();
                
                if (storedDate !== currentDate) {
                    fetchToday();
                    localStorage.setItem('currentDate', currentDate);
                }
            }, 60000); // Check every minute
        }

        // Share functionality
        async function shareDate() {
            const gregorianText = document.getElementById('today-gregorian').textContent;
            const hijriText = document.getElementById('today-hijri').textContent;
            const shareText = `${gregorianText}\n${hijriText}\n\nØªÙ… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù‡Ø¬Ø±ÙŠ ÙˆØ§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ`;
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…',
                        text: shareText,
                        url: window.location.href
                    });
                } catch (error) {
                    if (error.name !== 'AbortError') {
                        fallbackShare(shareText);
                    }
                }
            } else {
                fallbackShare(shareText);
            }
        }

        function fallbackShare(text) {
            // Create temporary input
            const input = document.createElement('textarea');
            input.value = text;
            document.body.appendChild(input);
            input.select();
            
            try {
                document.execCommand('copy');
                alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„ØªØ§Ø±ÙŠØ®! ÙŠÙ…ÙƒÙ†Ùƒ Ù„ØµÙ‚Ù‡ ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù†');
            } catch (err) {
                alert('Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ù†Ø³Ø® Ø§Ù„ØªØ§Ø±ÙŠØ®');
            }
            
            document.body.removeChild(input);
        }

        // Share to WhatsApp
        function shareToWhatsApp() {
            const gregorianText = document.getElementById('today-gregorian').textContent;
            const hijriText = document.getElementById('today-hijri').textContent;
            const shareText = `${gregorianText}\n${hijriText}\n\nØªÙ… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù‡Ø¬Ø±ÙŠ ÙˆØ§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ`;
            
            // Encode the text for URL
            const encodedText = encodeURIComponent(shareText);
            
            // Create WhatsApp URL
            const whatsappUrl = `https://wa.me/?text=${encodedText}`;
            
            // Open in new tab
            window.open(whatsappUrl, '_blank');
        }

        // Enhanced offline support
        async function checkConnectivity() {
            try {
                const response = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Riyadh&country=Saudi%20Arabia&method=4');
                if (response.ok) {
                    // We're online - update dates
                    fetchToday();
                    return true;
                }
            } catch (error) {
                console.log('Offline mode');
            }
            return false;
        }

        // Enhanced notification system
        function setupNotifications() {
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        // Schedule notifications for different times
                        scheduleNotification(9, 0, 'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±! â˜€ï¸');  // Morning
                        scheduleNotification(13, 0, 'ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ® ğŸ“…'); // Afternoon
                        scheduleNotification(19, 0, 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±! ğŸŒ™');   // Evening
                    }
                });
            }
        }

        let eventRemindersEnabled = true;

        function scheduleNotification(hour, minute, greeting) {
            const now = new Date();
            const scheduledTime = new Date(now);
            scheduledTime.setHours(hour, minute, 0, 0);
            
            if (scheduledTime <= now) {
                scheduledTime.setDate(scheduledTime.getDate() + 1);
            }
            
            const timeUntilNotification = scheduledTime - now;
            
            setTimeout(() => {
                const gregorianText = document.getElementById('today-gregorian').textContent;
                const hijriText = document.getElementById('today-hijri').textContent;
                
                new Notification(greeting, {
                    body: `${gregorianText}\n${hijriText}`,
                    icon: 'icon-192.png',
                    badge: 'icon-192.png',
                    tag: `daily-date-${hour}`,
                    renotify: true
                });
                
                // Schedule next day's notification
                scheduleNotification(hour, minute, greeting);
            }, timeUntilNotification);
        }

        // Schedule a one-time reminder for a specific event after N days (works while the page is open)
        function scheduleEventReminder(reminderId, title, body, daysUntil) {
            if (!eventRemindersEnabled) return;
            if (!('Notification' in window)) return;
            if (Notification.permission !== 'granted') return;

            const now = new Date();
            // Target time: at 9:00 AM on the event day (approx based on daysUntil)
            const target = new Date(now.getTime() + daysUntil * 24 * 60 * 60 * 1000);
            target.setHours(9, 0, 0, 0);

            let delay = target.getTime() - now.getTime();
            if (delay < 0) delay = 0;

            setTimeout(() => {
                try {
                    new Notification(title, {
                        body,
                        icon: 'icon-192.png',
                        badge: 'icon-192.png',
                        tag: reminderId,
                        renotify: true
                    });
                } catch (e) {
                    console.error('Error showing event reminder notification', e);
                }
            }, delay);
        }

        // Islamic Events
        const islamicEvents = {
            ramadan: { month: 9, day: 1, name: 'Ø±Ù…Ø¶Ø§Ù†' },
            eidFitr: { month: 10, day: 1, name: 'Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø±' },
            hajj: { month: 12, day: 8, name: 'Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬' },
            eidAdha: { month: 12, day: 10, name: 'Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰' },
            hijriYear: { month: 1, day: 1, name: 'Ø±Ø£Ø³ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù‡Ø¬Ø±ÙŠØ©' },
            ashura: { month: 1, day: 10, name: 'Ø¹Ø§Ø´ÙˆØ±Ø§Ø¡' }
        };

        // National Events (Gregorian)
        const nationalEvents = {
            saudiNationalDay: { month: 9, day: 23, name: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ' },   // 23 September
            saudiFoundingDay: { month: 2, day: 22, name: 'ÙŠÙˆÙ… Ø§Ù„ØªØ£Ø³ÙŠØ³' }             // 22 February
        };

        // Cultural Events (Gregorian)
        const culturalEvents2025 = {
            riyadhBookFair: {
                name: 'Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙŠØ§Ø¶ Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ù„ÙƒØªØ§Ø¨ 2025',
                // ÙŠØ¨Ø¯Ø£ 2 Ø£ÙƒØªÙˆØ¨Ø± 2025
                start: new Date(2025, 9, 2),  // Ø´Ù‡Ø± 10 (Ø£ÙƒØªÙˆØ¨Ø±) = index 9
                end: new Date(2025, 9, 11)
            },
            jeddahBookFair: {
                name: 'Ù…Ø¹Ø±Ø¶ Ø¬Ø¯Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ù„ÙƒØªØ§Ø¨ 2025',
                // Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¯ÙˆØ±Ø© 2024 (12 Ø¯ÙŠØ³Ù…Ø¨Ø±)
                start: new Date(2025, 11, 12), // Ø¯ÙŠØ³Ù…Ø¨Ø± = index 11
                end: new Date(2025, 11, 20)
            }
        };

        function updateCulturalEvents() {
            const now = new Date();

            // Helper: Ù†Øµ Ø§Ù„ÙØ±Ù‚ Ø¨Ø§Ù„Ø£ÙŠØ§Ù…
            function diffText(targetDate, label) {
                const oneDay = 1000 * 60 * 60 * 24;
                const diffDays = Math.ceil((targetDate.getTime() - now.getTime()) / oneDay);

                if (diffDays > 0) {
                    return `${label} Ø¨Ø¹Ø¯ ${diffDays} ÙŠÙˆÙ…`;
                } else if (diffDays === 0) {
                    return `${label} Ø§Ù„ÙŠÙˆÙ…`;
                } else {
                    return `${label} - Ø§Ù†ØªÙ‡Øª`;
                }
            }

            // Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙŠØ§Ø¶ Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ù„ÙƒØªØ§Ø¨ 2025
            const riyadhEl = document.getElementById('riyadh-bookfair');
            if (riyadhEl) {
                const ev = culturalEvents2025.riyadhBookFair;
                if (now < ev.start) {
                    riyadhEl.textContent = diffText(ev.start, 'Ù…Ù† 2 Ø£ÙƒØªÙˆØ¨Ø± Ø¥Ù„Ù‰ 11 Ø£ÙƒØªÙˆØ¨Ø± 2025 - Ù…ØªØ¨Ù‚Ù');
                } else if (now >= ev.start && now <= ev.end) {
                    riyadhEl.textContent = 'Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙŠØ§Ø¶ Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ù„ÙƒØªØ§Ø¨ 2025 - Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¢Ù† Ù…Ù† 2 Ø¥Ù„Ù‰ 11 Ø£ÙƒØªÙˆØ¨Ø± 2025';
                } else {
                    riyadhEl.textContent = 'Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙŠØ§Ø¶ Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ù„ÙƒØªØ§Ø¨ 2025 - Ø§Ù†ØªÙ‡Øª Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© (2 Ø¥Ù„Ù‰ 11 Ø£ÙƒØªÙˆØ¨Ø± 2025)';
                }
            }

            // Ù…Ø¹Ø±Ø¶ Ø¬Ø¯Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ù„ÙƒØªØ§Ø¨ 2025 (ØªØ§Ø±ÙŠØ® ØªÙ‚Ø±ÙŠØ¨ÙŠ 12 Ø¯ÙŠØ³Ù…Ø¨Ø±)
            const jeddahEl = document.getElementById('jeddah-bookfair');
            if (jeddahEl) {
                const ev = culturalEvents2025.jeddahBookFair;
                if (now < ev.start) {
                    jeddahEl.textContent = diffText(ev.start, 'Ù…Ù† 12 Ø¯ÙŠØ³Ù…Ø¨Ø± (ØªØ§Ø±ÙŠØ® ØªÙ‚Ø±ÙŠØ¨ÙŠ) - Ù…ØªØ¨Ù‚Ù');
                } else if (now >= ev.start && now <= ev.end) {
                    jeddahEl.textContent = 'Ù…Ø¹Ø±Ø¶ Ø¬Ø¯Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ù„ÙƒØªØ§Ø¨ 2025 - Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© Ù‚Ø§Ø¦Ù…Ø© ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ Ø­ÙˆÙ„ 12 Ø¯ÙŠØ³Ù…Ø¨Ø± (ØªØ§Ø±ÙŠØ® ØªÙ‚Ø±ÙŠØ¨ÙŠ)';
                } else {
                    jeddahEl.textContent = 'Ù…Ø¹Ø±Ø¶ Ø¬Ø¯Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ù„ÙƒØªØ§Ø¨ 2025 - ÙŠÙÙ‚Ø§Ù… ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ ÙÙŠ Ø¯ÙŠØ³Ù…Ø¨Ø±ØŒ Ø§Ù†ØªÙ‡Øª Ø¯ÙˆØ±Ø© 2025 Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©';
                }
            }

            // Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (18 Ø¯ÙŠØ³Ù…Ø¨Ø± Ù…Ù† ÙƒÙ„ Ø¹Ø§Ù…)
            const arabicDayEl = document.getElementById('arabic-language-day');
            if (arabicDayEl) {
                const currentYear = now.getFullYear();
                let target = new Date(currentYear, 11, 18); // 18 Ø¯ÙŠØ³Ù…Ø¨Ø±
                if (target < now) {
                    target = new Date(currentYear + 1, 11, 18);
                }

                const oneDay = 1000 * 60 * 60 * 24;
                const diffDays = Math.ceil((target.getTime() - now.getTime()) / oneDay);

                if (diffDays > 0) {
                    arabicDayEl.textContent = `Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (18 Ø¯ÙŠØ³Ù…Ø¨Ø±) Ø¨Ø¹Ø¯ ${diffDays} ÙŠÙˆÙ…`;
                } else {
                    arabicDayEl.textContent = 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙŠÙˆÙ… (18 Ø¯ÙŠØ³Ù…Ø¨Ø±)';
                }
            }
        }

        async function updateIslamicEvents() {
            try {
                const now = new Date();
                const response = await fetch(`https://api.aladhan.com/v1/gToH/${now.getDate()}-${now.getMonth() + 1}-${now.getFullYear()}`);
                const data = await response.json();
                
                if (response.ok && data.code === 200) {
                    const currentHijri = data.data.hijri;
                    const currentMonth = parseInt(currentHijri.month.number);
                    const currentDay = parseInt(currentHijri.day);
                    
                    // Find next event
                    let nextEvent = null;
                    let minDays = 366;
                    
                    for (const [key, event] of Object.entries(islamicEvents)) {
                        let daysUntil = calculateDaysUntil(currentMonth, currentDay, event.month, event.day);
                        if (daysUntil < minDays && daysUntil > 0) {
                            minDays = daysUntil;
                            nextEvent = { ...event, daysUntil };
                        }
                    }
                    
                    if (nextEvent) {
                        document.getElementById('next-event').textContent = `${nextEvent.name} Ø¨Ø¹Ø¯ ${nextEvent.daysUntil} ÙŠÙˆÙ…`;
                        startCountdown(nextEvent.daysUntil);
                    }
                    
                    // Update all event dates
                    updateEventDates(currentHijri.year);
                }
            } catch (error) {
                console.error('Error updating Islamic events:', error);
            }
        }

        function calculateDaysUntil(currentMonth, currentDay, targetMonth, targetDay) {
            let months = targetMonth - currentMonth;
            if (months < 0) months += 12;
            let days = targetDay - currentDay;
            return months * 30 + days;
        }

        function startCountdown(days) {
            const countdownElement = document.getElementById('event-countdown');
            const hours = days * 24;
            const minutes = hours * 60;
            const seconds = minutes * 60;
            
            const endTime = new Date().getTime() + (seconds * 1000);
            
            const timer = setInterval(() => {
                const now = new Date().getTime();
                const distance = endTime - now;
                
                const d = Math.floor(distance / (1000 * 60 * 60 * 24));
                const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((distance % (1000 * 60)) / 1000);
                
                countdownElement.textContent = `${d} ÙŠÙˆÙ… ${h} Ø³Ø§Ø¹Ø© ${m} Ø¯Ù‚ÙŠÙ‚Ø© ${s} Ø«Ø§Ù†ÙŠØ©`;
                
                if (distance < 0) {
                    clearInterval(timer);
                    updateIslamicEvents();
                }
            }, 1000);
        }

        async function updateEventDates(hijriYear) {
            document.getElementById('ramadan-date').textContent = `1 Ø±Ù…Ø¶Ø§Ù† ${hijriYear}`;
            document.getElementById('eid-fitr-date').textContent = `1 Ø´ÙˆØ§Ù„ ${hijriYear}`;
            document.getElementById('hajj-date').textContent = `8 Ø°Ùˆ Ø§Ù„Ø­Ø¬Ø© ${hijriYear}`;
            document.getElementById('eid-adha-date').textContent = `10 Ø°Ùˆ Ø§Ù„Ø­Ø¬Ø© ${hijriYear}`;
            document.getElementById('new-year-date').textContent = `1 Ù…Ø­Ø±Ù… ${parseInt(hijriYear) + 1}`;
            document.getElementById('ashura-date').textContent = `10 Ù…Ø­Ø±Ù… ${parseInt(hijriYear) + 1}`;
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Try to show last saved dates immediately
            loadLastSavedDates();
            
            // Setup enhanced notifications
            setupNotifications();
            
            // Check connectivity and update if online
            checkConnectivity();
            
            // Schedule regular connectivity checks
            setInterval(checkConnectivity, 300000); // Every 5 minutes
            
            // Schedule next update
            scheduleNextUpdate();
            
            // Start auto-refresh
            startAutoRefresh();
            
            // Load saved theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            const root = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');
            
            if (savedTheme === 'dark') {
                root.setAttribute('data-theme', 'dark');
                themeIcon.textContent = 'ğŸŒ™';
            } else {
                root.removeAttribute('data-theme');
                themeIcon.textContent = 'ğŸŒ';
            }

            // Load reminders preference
            const savedReminders = localStorage.getItem('eventRemindersEnabled');
            if (savedReminders === 'false') {
                eventRemindersEnabled = false;
            } else {
                eventRemindersEnabled = true;
            }
            updateReminderToggleUI();

            // Load favorites
            loadFavorites();

            // Set today's date in date picker
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            document.getElementById('datePicker').value = today;
            convertDate();
            
            // Update Islamic events
            updateIslamicEvents();
            // Update national events
            updateNationalEvents();
            // Update cultural events
            updateCulturalEvents();
            // Update events every day
            setInterval(updateIslamicEvents, 86400000);
            setInterval(updateNationalEvents, 86400000);
            setInterval(updateCulturalEvents, 86400000);
        });

        function toggleReminders() {
            eventRemindersEnabled = !eventRemindersEnabled;
            localStorage.setItem('eventRemindersEnabled', eventRemindersEnabled ? 'true' : 'false');
            updateReminderToggleUI();
        }

        function updateReminderToggleUI() {
            const btn = document.getElementById('reminder-toggle');
            const icon = document.getElementById('reminder-icon');
            if (!btn || !icon) return;

            if (eventRemindersEnabled) {
                btn.classList.remove('off');
                icon.textContent = 'ğŸ””';
                btn.title = 'Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ù…ÙØ¹Ù„Ø© - Ø§Ø¶ØºØ· Ù„Ø¥ÙŠÙ‚Ø§ÙÙ‡Ø§';
            } else {
                btn.classList.add('off');
                icon.textContent = 'ğŸ”•';
                btn.title = 'Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ù…ØªÙˆÙ‚ÙØ© - Ø§Ø¶ØºØ· Ù„ØªÙØ¹ÙŠÙ„Ù‡Ø§';
            }
        }

        function updateNationalEvents() {
            const now = new Date();

            // Helper to compute days until a fixed Gregorian date (month:1-12, day:1-31)
            function daysUntilGregorianEvent(targetMonth, targetDay) {
                const currentYear = now.getFullYear();
                let targetDate = new Date(currentYear, targetMonth - 1, targetDay);

                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù… Ù‚Ø¯ Ù…Ø¶Ù‰ØŒ Ù†Ø­ØªØ³Ø¨ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
                if (targetDate < now) {
                    targetDate = new Date(currentYear + 1, targetMonth - 1, targetDay);
                }

                const diffMs = targetDate.getTime() - now.getTime();
                return Math.ceil(diffMs / (1000 * 60 * 60 * 24));
            }

            // Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ
            const nationalDayDays = daysUntilGregorianEvent(nationalEvents.saudiNationalDay.month, nationalEvents.saudiNationalDay.day);
            const nationalDayElement = document.getElementById('saudi-national-day');
            if (nationalDayElement) {
                nationalDayElement.textContent = `${nationalEvents.saudiNationalDay.day} / ${nationalEvents.saudiNationalDay.month} - Ù…ØªØ¨Ù‚Ù ${nationalDayDays} ÙŠÙˆÙ…`;
            }

            // ÙŠÙˆÙ… Ø§Ù„ØªØ£Ø³ÙŠØ³
            const foundingDayDays = daysUntilGregorianEvent(nationalEvents.saudiFoundingDay.month, nationalEvents.saudiFoundingDay.day);
            const foundingDayElement = document.getElementById('saudi-founding-day');
            if (foundingDayElement) {
                foundingDayElement.textContent = `${nationalEvents.saudiFoundingDay.day} / ${nationalEvents.saudiFoundingDay.month} - Ù…ØªØ¨Ù‚Ù ${foundingDayDays} ÙŠÙˆÙ…`;
            }

            // Ø§Ø®ØªØ± Ø£Ù‚Ø±Ø¨ Ù…Ù†Ø§Ø³Ø¨Ø© ÙˆØ·Ù†ÙŠØ© Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
            const todayNextNational = document.getElementById('today-next-national');
            const todayNextNationalText = document.getElementById('today-next-national-text');
            const todayNextNationalIcon = todayNextNational ? todayNextNational.querySelector('.icon') : null;

            if (todayNextNational && todayNextNationalText) {
                let nextName;
                let nextDays;

                if (nationalDayDays <= foundingDayDays) {
                    nextName = nationalEvents.saudiNationalDay.name;
                    nextDays = nationalDayDays;

                    todayNextNational.classList.remove('national-founding');
                    todayNextNational.classList.add('national-day');
                } else {
                    nextName = nationalEvents.saudiFoundingDay.name;
                    nextDays = foundingDayDays;

                    todayNextNational.classList.remove('national-day');
                    todayNextNational.classList.add('national-founding');
                }

                const icon = nationalIcons[nextName] || 'ğŸ‡¸ğŸ‡¦';
                todayNextNational.style.display = 'inline-flex';
                todayNextNationalText.textContent = `${nextName} Ø¨Ø¹Ø¯ ${nextDays} ÙŠÙˆÙ…`;
                if (todayNextNationalIcon) {
                    todayNextNationalIcon.textContent = icon;
                }

                // Schedule reminder notification for the next national event
                const reminderId = nextName === nationalEvents.saudiNationalDay.name ? 'national-day' : 'national-founding';

                // ÙÙ‚Ø· Ù‚Ø¨Ù„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø¨Ø«Ù„Ø§Ø«Ø© Ø£ÙŠØ§Ù… (Ø¥Ù† Ø£Ù…ÙƒÙ†)
                if (nextDays >= 3) {
                    scheduleEventReminder(
                        `national-${reminderId}-3days`,
                        'ØªØ°ÙƒÙŠØ± Ù…Ù†Ø§Ø³Ø¨Ø© ÙˆØ·Ù†ÙŠØ©',
                        `${nextName} Ø¨Ø¹Ø¯ 3 Ø£ÙŠØ§Ù… Ø¨Ø¥Ø°Ù† Ø§Ù„Ù„Ù‡`,
                        nextDays - 3
                    );
                }
            }
        }

        function updateTickerContent(events) {
            const tickerContent = document.getElementById('ticker-content');
            let content = '';
            
            for (const event of events) {
                content += `
                    <span class="ticker-item">
                        ${event.name} Ø¨Ø¹Ø¯ <span class="days">${event.daysUntil}</span> ÙŠÙˆÙ…
                    </span>
                `;
            }
            
            tickerContent.innerHTML = content;
        }

        async function updateIslamicEvents() {
            try {
                const now = new Date();
                const response = await fetch(`https://api.aladhan.com/v1/gToH/${now.getDate()}-${now.getMonth() + 1}-${now.getFullYear()}`);
                const data = await response.json();
                
                if (response.ok && data.code === 200) {
                    const currentHijri = data.data.hijri;
                    const currentMonth = parseInt(currentHijri.month.number);
                    const currentDay = parseInt(currentHijri.day);
                    
                    // Find all upcoming events
                    let upcomingEvents = [];
                    
                    for (const [key, event] of Object.entries(islamicEvents)) {
                        let daysUntil = calculateDaysUntil(currentMonth, currentDay, event.month, event.day);
                        if (daysUntil > 0) {
                            upcomingEvents.push({
                                key,
                                name: event.name,
                                daysUntil: daysUntil
                            });
                        }
                    }
                    
                    // Sort by closest date
                    upcomingEvents.sort((a, b) => a.daysUntil - b.daysUntil);
                    
                    // Update ticker
                    updateTickerContent(upcomingEvents);
                    
                    // Update next Islamic event display and card style
                    if (upcomingEvents.length > 0) {
                        const nextEvent = upcomingEvents[0];
                        const nextEventElement = document.getElementById('next-event');
                        const upcomingCard = document.getElementById('upcoming-event');
                        const todayNextEvent = document.getElementById('today-next-event');
                        const todayNextEventText = document.getElementById('today-next-event-text');
                        const todayNextEventIcon = todayNextEvent ? todayNextEvent.querySelector('.icon') : null;

                        if (nextEventElement) {
                            nextEventElement.textContent = `${nextEvent.name} Ø¨Ø¹Ø¯ ${nextEvent.daysUntil} ÙŠÙˆÙ…`;
                        }

                        // Update small badge near today's date
                        if (todayNextEvent && todayNextEventText) {
                            const icon = eventIcons[nextEvent.name] || 'ğŸŠ';
                            todayNextEvent.style.display = 'inline-flex';
                            todayNextEventText.textContent = `${nextEvent.name} Ø¨Ø¹Ø¯ ${nextEvent.daysUntil} ÙŠÙˆÙ…`;
                            if (todayNextEventIcon) {
                                todayNextEventIcon.textContent = icon;
                            }

                            // Reset Islamic color variants
                            todayNextEvent.classList.remove(
                                'islamic-ramadan',
                                'islamic-eid-fitr',
                                'islamic-hajj',
                                'islamic-eid-adha',
                                'islamic-hijri-year',
                                'islamic-ashura'
                            );
                        }

                        if (upcomingCard) {
                            // Reset previous classes
                            upcomingCard.classList.remove(
                                'ramadan-card',
                                'eid-fitr-card',
                                'hajj-card',
                                'eid-adha-card',
                                'hijri-year-card',
                                'ashura-card'
                            );

                            // Base animation class
                            upcomingCard.classList.add('pulse');

                            // Map event key to card style
                            switch (nextEvent.key) {
                                case 'ramadan':
                                    upcomingCard.classList.add('ramadan-card');
                                    if (todayNextEvent) todayNextEvent.classList.add('islamic-ramadan');
                                    break;
                                case 'eidFitr':
                                    upcomingCard.classList.add('eid-fitr-card');
                                    if (todayNextEvent) todayNextEvent.classList.add('islamic-eid-fitr');
                                    break;
                                case 'hajj':
                                    upcomingCard.classList.add('hajj-card');
                                    if (todayNextEvent) todayNextEvent.classList.add('islamic-hajj');
                                    break;
                                case 'eidAdha':
                                    upcomingCard.classList.add('eid-adha-card');
                                    if (todayNextEvent) todayNextEvent.classList.add('islamic-eid-adha');
                                    break;
                                case 'hijriYear':
                                    upcomingCard.classList.add('hijri-year-card');
                                    if (todayNextEvent) todayNextEvent.classList.add('islamic-hijri-year');
                                    break;
                                case 'ashura':
                                    upcomingCard.classList.add('ashura-card');
                                    if (todayNextEvent) todayNextEvent.classList.add('islamic-ashura');
                                    break;
                            }
                        }

                        // Schedule reminder notification for the next Islamic event
                        // ÙÙ‚Ø· Ù‚Ø¨Ù„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø¨Ø«Ù„Ø§Ø«Ø© Ø£ÙŠØ§Ù… (Ø¥Ù† Ø£Ù…ÙƒÙ†)
                        if (nextEvent.daysUntil >= 3) {
                            scheduleEventReminder(
                                `islamic-${nextEvent.key}-3days`,
                                'ØªØ°ÙƒÙŠØ± Ù…Ù†Ø§Ø³Ø¨Ø© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©',
                                `${nextEvent.name} Ø¨Ø¹Ø¯ 3 Ø£ÙŠØ§Ù… Ø¨Ø¥Ø°Ù† Ø§Ù„Ù„Ù‡`,
                                nextEvent.daysUntil - 3
                            );
                        }

                        startCountdown(nextEvent.daysUntil);
                    }
                    
                    // Update all event dates
                    updateEventDates(currentHijri.year);
                }
            } catch (error) {
                console.error('Error updating Islamic events:', error);
            }
        }

        const eventIcons = {
            'Ø±Ù…Ø¶Ø§Ù†': 'ğŸŒ™',
            'Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø±': 'ğŸ‰',
            'Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬': 'â›º',
            'Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰': 'ğŸ‘',
            'Ø±Ø£Ø³ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù‡Ø¬Ø±ÙŠØ©': 'ğŸ“…',
            'Ø¹Ø§Ø´ÙˆØ±Ø§Ø¡': 'ğŸ•Œ'
        };

        const nationalIcons = {
            'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ': 'ğŸ‡¸ğŸ‡¦',
            'ÙŠÙˆÙ… Ø§Ù„ØªØ£Ø³ÙŠØ³': 'ğŸ›ï¸'
        };

        function updateTickerContent(events) {
            const tickerContent = document.getElementById('ticker-content');
            let content = '';
            
            for (const event of events) {
                const icon = eventIcons[event.name] || 'ğŸŠ';
                content += `
                    <span class="ticker-item">
                        <span class="icon">${icon}</span>
                        ${event.name} Ø¨Ø¹Ø¯ <span class="days">${event.daysUntil}</span> ÙŠÙˆÙ…
                    </span>
                `;
            }
            
            tickerContent.innerHTML = content;
        }
    </script>
</body>
</html>
